<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="9 Data Visualization | Computing Concepts for Public Health Researchers" />
<meta property="og:type" content="book" />


<meta property="og:description" content="Resources and tutorials for R and SAS analysis geared toward public health students." />
<meta name="github-repo" content="jrgant/StatsCompPH-BrownSPH" />

<meta name="author" content="Jason Gantenberg, PhD, MPH" />



<meta name="description" content="Resources and tutorials for R and SAS analysis geared toward public health students.">

<title>9 Data Visualization | Computing Concepts for Public Health Researchers</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<!-- Import LESS library -->
<link rel="stylesheet/less" type="text/css" href="styles/switched-dev.less" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/less.js/3.9.0/less.min.js"></script>

<!-- Import custom element definitions -->
<script src="styles/custom-elements.js"></script>

<!-- <link rel="stylesheet" href="styles/switched-dev.css" /> -->

<!-- MathJax -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>




</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#learning-objectives"><span class="toc-section-number">1</span> Learning Objectives</a><ul>
<li><a href="index.html#main-objectives"><span class="toc-section-number">1.1</span> Main objectives</a></li>
<li><a href="index.html#secondary-objectives"><span class="toc-section-number">1.2</span> Secondary objectives</a></li>
<li><a href="index.html#acknowledgements"><span class="toc-section-number">1.3</span> Acknowledgements</a></li>
</ul></li>
<li class="has-sub"><a href="startup.html#startup"><span class="toc-section-number">2</span> Getting Started</a><ul>
<li><a href="startup.html#getting-started-with-r"><span class="toc-section-number">2.1</span> Getting Started with R</a></li>
<li><a href="startup.html#getting-started-with-sas"><span class="toc-section-number">2.2</span> Getting Started with SAS</a></li>
</ul></li>
<li class="has-sub"><a href="data-structures.html#data-structures"><span class="toc-section-number">3</span> Data Structures</a><ul>
<li><a href="data-structures.html#major-differences-between-r-and-sas"><span class="toc-section-number">3.1</span> Major Differences Between R and SAS</a></li>
<li><a href="data-structures.html#r-object-and-value-classes"><span class="toc-section-number">3.2</span> R: Object and Value Classes</a></li>
</ul></li>
<li class="has-sub"><a href="importing-and-exporting-data.html#importing-and-exporting-data"><span class="toc-section-number">4</span> Importing and Exporting Data</a><ul>
<li class="has-sub"><a href="importing-and-exporting-data.html#r-reading-and-writing-data"><span class="toc-section-number">4.1</span> R: Reading and Writing Data</a><ul>
<li><a href="importing-and-exporting-data.html#reading-data"><span class="toc-section-number">4.1.1</span> Reading Data</a></li>
<li><a href="importing-and-exporting-data.html#writing-data"><span class="toc-section-number">4.1.2</span> Writing Data</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="working-with-data.html#working-with-data"><span class="toc-section-number">5</span> Working with Data</a><ul>
<li><a href="working-with-data.html#objects-in-r"><span class="toc-section-number">5.1</span> Objects in R</a></li>
<li class="has-sub"><a href="working-with-data.html#more-complex-objects"><span class="toc-section-number">5.2</span> More Complex Objects</a><ul>
<li><a href="working-with-data.html#vectors"><span class="toc-section-number">5.2.1</span> Vectors</a></li>
<li><a href="working-with-data.html#matrices"><span class="toc-section-number">5.2.2</span> Matrices</a></li>
<li><a href="working-with-data.html#lists"><span class="toc-section-number">5.2.3</span> Lists</a></li>
<li><a href="working-with-data.html#data-frames"><span class="toc-section-number">5.2.4</span> Data Frames</a></li>
<li><a href="working-with-data.html#other-object-classes"><span class="toc-section-number">5.2.5</span> Other Object Classes</a></li>
</ul></li>
<li class="has-sub"><a href="working-with-data.html#conducting-operations-on-objects"><span class="toc-section-number">5.3</span> Conducting Operations on Objects</a><ul>
<li><a href="working-with-data.html#arithmetic-operations"><span class="toc-section-number">5.3.1</span> Arithmetic Operations</a></li>
<li><a href="working-with-data.html#logical-operations"><span class="toc-section-number">5.3.2</span> Logical Operations</a></li>
<li><a href="working-with-data.html#recycling"><span class="toc-section-number">5.3.3</span> Recycling</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="statistical-analysis.html#statistical-analysis"><span class="toc-section-number">6</span> Statistical Analysis</a><ul>
<li class="has-sub"><a href="statistical-analysis.html#setup"><span class="toc-section-number">6.1</span> Setup</a><ul>
<li><a href="statistical-analysis.html#data"><span class="toc-section-number">6.1.1</span> Data</a></li>
<li><a href="statistical-analysis.html#nhefs-codebook"><span class="toc-section-number">6.1.2</span> NHEFS Codebook</a></li>
</ul></li>
<li><a href="statistical-analysis.html#exploratory-data-analysis"><span class="toc-section-number">6.2</span> Exploratory Data Analysis</a></li>
<li><a href="statistical-analysis.html#tabular-analysis"><span class="toc-section-number">6.3</span> Tabular Analysis</a></li>
<li class="has-sub"><a href="statistical-analysis.html#regression-models"><span class="toc-section-number">6.4</span> Regression Models</a><ul>
<li><a href="statistical-analysis.html#linear-regression"><span class="toc-section-number">6.4.1</span> Linear regression</a></li>
<li><a href="statistical-analysis.html#logistic-regression"><span class="toc-section-number">6.4.2</span> Logistic regression</a></li>
<li><a href="statistical-analysis.html#log-binomial-regression"><span class="toc-section-number">6.4.3</span> Log-binomial regression</a></li>
<li><a href="statistical-analysis.html#modified-poisson-regression"><span class="toc-section-number">6.4.4</span> Modified Poisson regression</a></li>
<li><a href="statistical-analysis.html#poisson-regression"><span class="toc-section-number">6.4.5</span> Poisson regression</a></li>
<li><a href="statistical-analysis.html#survival-analysis"><span class="toc-section-number">6.4.6</span> Survival analysis</a></li>
<li><a href="statistical-analysis.html#overdispersion"><span class="toc-section-number">6.4.7</span> Overdispersion</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="getting-comfortable-with-loops-and-logic.html#getting-comfortable-with-loops-and-logic"><span class="toc-section-number">7</span> Getting Comfortable with Loops and Logic</a><ul>
<li><a href="getting-comfortable-with-loops-and-logic.html#whats-a-loop"><span class="toc-section-number">7.1</span> What’s a Loop?</a></li>
<li class="has-sub"><a href="getting-comfortable-with-loops-and-logic.html#why-loop"><span class="toc-section-number">7.2</span> Why Loop?</a><ul>
<li><a href="getting-comfortable-with-loops-and-logic.html#curly-braces"><span class="toc-section-number">7.2.1</span> Curly Braces</a></li>
</ul></li>
<li class="has-sub"><a href="getting-comfortable-with-loops-and-logic.html#nested-loops-conditional-logic-and-reinventing-wheels"><span class="toc-section-number">7.3</span> Nested Loops, Conditional Logic, and Reinventing Wheels</a><ul>
<li><a href="getting-comfortable-with-loops-and-logic.html#standard-loop"><span class="toc-section-number">7.3.1</span> Standard Loop</a></li>
<li><a href="getting-comfortable-with-loops-and-logic.html#vectorized-loops"><span class="toc-section-number">7.3.2</span> Vectorized Loops</a></li>
<li><a href="getting-comfortable-with-loops-and-logic.html#nested-loops"><span class="toc-section-number">7.3.3</span> Nested Loops</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="functionalizing-code.html#functionalizing-code"><span class="toc-section-number">8</span> Functionalizing Code</a><ul>
<li><a href="functionalizing-code.html#simulate-data"><span class="toc-section-number">8.1</span> Simulate Data</a></li>
<li><a href="functionalizing-code.html#the-old-way"><span class="toc-section-number">8.2</span> The Old Way</a></li>
<li><a href="functionalizing-code.html#a-new-way-part-1"><span class="toc-section-number">8.3</span> A New Way, Part 1</a></li>
<li class="has-sub"><a href="functionalizing-code.html#a-new-way-part-2"><span class="toc-section-number">8.4</span> A New Way, Part 2</a><ul>
<li><a href="functionalizing-code.html#loop-method-1"><span class="toc-section-number">8.4.1</span> Loop Method 1</a></li>
<li><a href="functionalizing-code.html#loop-method-2"><span class="toc-section-number">8.4.2</span> Loop Method 2</a></li>
<li><a href="functionalizing-code.html#add-a-new-analysis"><span class="toc-section-number">8.4.3</span> Add a New Analysis</a></li>
</ul></li>
<li><a href="functionalizing-code.html#a-new-way-part-3"><span class="toc-section-number">8.5</span> A New Way, Part 3</a></li>
<li class="has-sub"><a href="functionalizing-code.html#approximate-in-sas"><span class="toc-section-number">8.6</span> Approximate in SAS</a><ul>
<li><a href="functionalizing-code.html#simulate-data-1"><span class="toc-section-number">8.6.1</span> Simulate Data</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="data-visualization.html#data-visualization"><span class="toc-section-number">9</span> Data Visualization</a><ul>
<li class="has-sub"><a href="data-visualization.html#base-r-examples"><span class="toc-section-number">9.1</span> Base R examples</a><ul>
<li><a href="data-visualization.html#boxplots"><span class="toc-section-number">9.1.1</span> Boxplots</a></li>
<li><a href="data-visualization.html#density-plots"><span class="toc-section-number">9.1.2</span> Density Plots</a></li>
<li><a href="data-visualization.html#scatterplots"><span class="toc-section-number">9.1.3</span> Scatterplots</a></li>
<li><a href="data-visualization.html#scatterplot-matrix"><span class="toc-section-number">9.1.4</span> Scatterplot Matrix</a></li>
<li><a href="data-visualization.html#histograms"><span class="toc-section-number">9.1.5</span> Histograms</a></li>
<li><a href="data-visualization.html#linear-regression-diagnostics"><span class="toc-section-number">9.1.6</span> Linear Regression Diagnostics</a></li>
</ul></li>
<li class="has-sub"><a href="data-visualization.html#ggplot2-examples"><span class="toc-section-number">9.2</span> ggplot2 Examples</a><ul>
<li><a href="data-visualization.html#boxplots-1"><span class="toc-section-number">9.2.1</span> Boxplots</a></li>
<li><a href="data-visualization.html#density-plots-1"><span class="toc-section-number">9.2.2</span> Density Plots</a></li>
<li><a href="data-visualization.html#scatterplots-1"><span class="toc-section-number">9.2.3</span> Scatterplots</a></li>
<li><a href="data-visualization.html#faceted-plots"><span class="toc-section-number">9.2.4</span> Faceted Plots</a></li>
<li><a href="data-visualization.html#bar-plots"><span class="toc-section-number">9.2.5</span> Bar Plots</a></li>
<li><a href="data-visualization.html#scatterplot-matrix-1"><span class="toc-section-number">9.2.6</span> Scatterplot Matrix</a></li>
</ul></li>
</ul></li>
<li><a href="programming-concepts.html#programming-concepts"><span class="toc-section-number">10</span> Programming Concepts</a></li>
<li class="has-sub"><a href="resources.html#resources"><span class="toc-section-number">11</span> Resources</a><ul>
<li class="has-sub"><a href="resources.html#r"><span class="toc-section-number">11.1</span> R</a><ul>
<li><a href="resources.html#core-documentation"><span class="toc-section-number">11.1.1</span> Core Documentation</a></li>
<li><a href="resources.html#programming"><span class="toc-section-number">11.1.2</span> Programming</a></li>
<li><a href="resources.html#data-visualization-1"><span class="toc-section-number">11.1.3</span> Data Visualization</a></li>
<li><a href="resources.html#reproducible-research-and-version-control"><span class="toc-section-number">11.1.4</span> Reproducible Research and Version Control</a></li>
</ul></li>
<li class="has-sub"><a href="resources.html#sas"><span class="toc-section-number">11.2</span> SAS</a><ul>
<li><a href="resources.html#programming-and-core-documentation"><span class="toc-section-number">11.2.1</span> Programming and Core Documentation</a></li>
<li><a href="resources.html#reproducible-research"><span class="toc-section-number">11.2.2</span> Reproducible Research</a></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="data-visualization" class="section level1">
<h1><span class="header-section-number">9</span> Data Visualization</h1>
<p>Look at your data!</p>
<p>Yes, that means look at your raw data by producing subsets, printing to the console, and all the other things we’ve been doing. But it also means that we should visualize our data.</p>
<p>The potential purposes for doing so are legion, but we can name a few for starters:</p>
<ul>
<li>To detect errors (e.g., miscoded observations)</li>
<li>To detect missing data</li>
<li>To detect your own coding errors (e.g., miscoded derivative variables)</li>
<li>To see the variation of single variables and the covariation between pairs of variables</li>
<li>To summarize a lot of quantitative information so that it can be digested by the reader quickly and efficiently</li>
<li>To reveal relationships between exposure and outcome</li>
<li>To diagnose statistical or computational procedures (e.g., regressions, algorithms)</li>
<li>To make principled decisions about how to analyze your data</li>
</ul>
<p>Before we continue, though, we should keep one thing in mind: <strong>data visualization is not about making pretty pictures</strong>. Saying so does not discount the importance of aesthetics in your visualizations. However, the aesthetics you employ should be chosen to make the message of the figure clear to your audience. In some cases, we might want to highlight a particular contrast between two variables. In others, we might want to visualize how a particular variable trends over time. In yet others, we may simply want to visualize features in our raw dataset.</p>
<p>Each of these objectives implies the usefulness of certain visualizations and the impropriety of others. In other words, we want the purpose of the visualization to dictate the means by which we display relevant data.</p>
<p>In this introduction, we will focus on a couple of broad concepts and code examples in order to get you up and running as quickly as possible. However, I highly recommend two (freely available) resources in particular:</p>
<ol style="list-style-type: decimal">
<li><p><a href="https://socviz.co/">Data Visualization: A Practical Introduction</a> by Kieran Healy</p></li>
<li><p><a href="http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html">Top 50 ggplot2 Visualizations - The Master List (with Full R Code)</a> by Selva Prabhakaran</p></li>
</ol>
<p>Keeping these bookmarked will probably cover about 90%<label for="tufte-sn-1" class="margin-toggle sidenote-number">1</label><input type="checkbox" id="tufte-sn-1" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">1</span> Source: Thin air</span> of your data visualization needs.</p>
<div id="base-r-examples" class="section level2">
<h2><span class="header-section-number">9.1</span> Base R examples</h2>
<p>You may find that working with plotting in base R is more efficient when you want quick-and-dirty visualizations—for instance, while you’re conducting exploratory data analysis.</p>
<div id="boxplots" class="section level3">
<h3><span class="header-section-number">9.1.1</span> Boxplots</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># using built-in iris dataset</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">boxplot</span>(iris<span class="op">$</span>Petal.Width)</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/base-r-bp-1.svg" width="75%"  style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">boxplot</span>(Petal.Width <span class="op">~</span><span class="st"> </span>Species, <span class="dt">data =</span> iris)</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/base-r-bp-2.svg" width="75%"  style="display: block; margin: auto;" /></p>
</div>
<div id="density-plots" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Density Plots</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">plot</span>(<span class="kw">density</span>(iris<span class="op">$</span>Petal.Width))</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/base-r-density-1.svg" width="75%"  style="display: block; margin: auto;" /></p>
</div>
<div id="scatterplots" class="section level3">
<h3><span class="header-section-number">9.1.3</span> Scatterplots</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">plot</span>(iris<span class="op">$</span>Petal.Width)</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/base-r-scatter-1.svg" width="75%"  style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">plot</span>(Petal.Width <span class="op">~</span><span class="st"> </span>Petal.Length, <span class="dt">data =</span> iris)</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/base-r-scatter-2.svg" width="75%"  style="display: block; margin: auto;" /></p>
</div>
<div id="scatterplot-matrix" class="section level3">
<h3><span class="header-section-number">9.1.4</span> Scatterplot Matrix</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">pairs</span>(iris)</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/base-r-scattermatrix-1.svg" width="100%"  style="display: block; margin: auto;" /></p>
</div>
<div id="histograms" class="section level3">
<h3><span class="header-section-number">9.1.5</span> Histograms</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">hist</span>(iris<span class="op">$</span>Petal.Width)</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/base-r-hist-1.svg" width="75%"  style="display: block; margin: auto;" /></p>
</div>
<div id="linear-regression-diagnostics" class="section level3">
<h3><span class="header-section-number">9.1.6</span> Linear Regression Diagnostics</h3>
<p>Base R and some packages provide built-in plotting methods for certain types of objects. Here, feeding an object of the class <code>lm</code> will return a series of linear regression diagnostics.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co">## run a regression on built-in dataset ChickWeight</span></a>
<a class="sourceLine" id="cb8-2" title="2">fit &lt;-<span class="st"> </span><span class="kw">lm</span>(weight <span class="op">~</span><span class="st"> </span>Diet, <span class="dt">data =</span> ChickWeight)</a>
<a class="sourceLine" id="cb8-3" title="3"><span class="kw">class</span>(fit)</a></code></pre></div>
<pre><code>## [1] &quot;lm&quot;</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">plot</span>(fit)</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/base-linear-reg-diag-1.svg" width="85%"  style="display: block; margin: auto;" /><img src="stats-comp-ph_files/figure-html/base-linear-reg-diag-2.svg" width="85%"  style="display: block; margin: auto;" /><img src="stats-comp-ph_files/figure-html/base-linear-reg-diag-3.svg" width="85%"  style="display: block; margin: auto;" /><img src="stats-comp-ph_files/figure-html/base-linear-reg-diag-4.svg" width="85%"  style="display: block; margin: auto;" /></p>
<p>If you run <code>plot(fit)</code> as above, you might find R irritating in that it will print these plots to your image device (image pane in RStudio) in succession, leaving you to flip between images. For a nicer output, you can output a grid of regression diagnostics.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">plot</span>(fit)</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/base-linear-reg-diag-grid-1.svg" width="85%"  style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="ggplot2-examples" class="section level2">
<h2><span class="header-section-number">9.2</span> ggplot2 Examples</h2>
<p>Before we start, let’s load a few of the packages we’ll be using.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">library</span>(ggplot2)  <span class="co"># plotting package</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw">library</span>(ggthemes) <span class="co"># a package that adds plot themes to ggplot2</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="kw">library</span>(magrittr) <span class="co"># use pipes &quot;%&gt;%&quot;</span></a></code></pre></div>
<p>Before, we get into the examples, I’m going to apply a universal theme for the subsequent plots:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">theme_set</span>(<span class="kw">theme_few</span>(<span class="dt">base_size =</span> <span class="dv">16</span>))</a></code></pre></div>
<p>The <code>ggplot2</code> package in R is an excellent package for data visualization based on the <em>grammar of graphics</em> concept.<label for="tufte-sn-2" class="margin-toggle sidenote-number">2</label><input type="checkbox" id="tufte-sn-2" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">2</span> Leland Wilkinson. <a href="https://link.springer.com/book/10.1007/0-387-28695-0">The Grammar of Graphics</a>. Springer, 2005.</span> The basic idea is to divide plot features into conceptual layers defined by their function in the visualization.</p>
<p>Here’s a general schema for how this concept maps to plot components in <code>ggplot2</code>:</p>
<ul>
<li><strong>data:</strong> the underlying data set and variables we wish to convert into plot aesthetics</li>
<li><strong>plot layer:</strong> geometric entities (<em>e.g.</em>, shapes, lines), statistical transformations, positioning elements</li>
<li><strong>scales:</strong> scales applied to geoms to map additional data dimensions (<em>e.g.</em>, a color gradient)</li>
<li><strong>coordinates:</strong> the coordinate system used to plot the data (<em>e.g.</em>, Cartesian, polar)</li>
<li><strong>facets:</strong> specifications that control a grid of plots, showing the same plot within multiple discrete groupings</li>
</ul>
<p>Note that I’ve assigned names to each element for the sake of introduction, but the descriptions themselves follow closely from Hadley Wickham’s (<code>ggplot2</code> creator) own in the paper referenced here.<label for="tufte-sn-3" class="margin-toggle sidenote-number">3</label><input type="checkbox" id="tufte-sn-3" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">3</span> Hadley Wickham (2010) A Layered Grammar of Graphics, <em>Journal of Computational and Graphical Statistics</em>, 19:1, 3-28, DOI: <a href="https://doi.org/10.1198/jcgs.2009.07098">10.1198/jcgs.2009.07098</a></span></p>
<p>In the following examples I will focus on longform syntax with the <code>ggplot</code> function. Learning the ins and outs of <code>ggplot2</code> will give you more flexibility and control over your images, particularly when you need to produce publication-quality graphics. However, <code>ggplot2</code> provides the <code>qplot</code> function for quick visualizations, akin to the base R graphics depicted above. One nice thing about <code>qplot</code> the its default setting to choose a geometric mapping automatically (hereafter, “geom”). Below, the function automatically selects a scatterplot.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">qplot</span>(<span class="dt">x =</span> Petal.Width, <span class="dt">y =</span> Petal.Length, <span class="dt">data =</span> iris)</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-qplot-1.svg" width="672"  style="display: block; margin: auto;" /></p>
<p>However, we can specify the geom explicitly. Here we get a smoothed line:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">qplot</span>(<span class="dt">x =</span> Petal.Width, <span class="dt">y =</span> Petal.Length, <span class="dt">data =</span> iris, <span class="dt">geom =</span> <span class="st">&quot;smooth&quot;</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="stats-comp-ph_files/figure-html/ggplot-qplot-geomspec-1.svg" width="672"  style="display: block; margin: auto;" /></p>
<p>The <a href="https://ggplot2.tidyverse.org/reference"><code>ggplot2</code> website</a> contains extensive documentation on all of the package’s functions, including many helpful worked examples.</p>
<p>All the examples below use the in-built <code>iris</code> data set. Let’s recall what it looks like:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">head</span>(iris, <span class="dt">n =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1           5.1         3.5          1.4         0.2  setosa
## 2           4.9         3.0          1.4         0.2  setosa
## 3           4.7         3.2          1.3         0.2  setosa
## 4           4.6         3.1          1.5         0.2  setosa
## 5           5.0         3.6          1.4         0.2  setosa
## 6           5.4         3.9          1.7         0.4  setosa
## 7           4.6         3.4          1.4         0.3  setosa
## 8           5.0         3.4          1.5         0.2  setosa
## 9           4.4         2.9          1.4         0.2  setosa
## 10          4.9         3.1          1.5         0.1  setosa</code></pre>
<p><span class="marginnote warning">
<strong>Strange Symbols</strong>
Note the difference between the <code>magrittr</code> pipe <code>%&gt;%</code>, which we use to feed our data set to the <code>ggplot()</code> function and the <code>+</code> symbol we use to bind together the lines describing plot elements. This distinction is mandatory, as <code>ggplot2</code> will not allow you to use the <code>magrittr</code> pipe to link plot layers.
</span></p>
<div id="boxplots-1" class="section level3">
<h3><span class="header-section-number">9.2.1</span> Boxplots</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Petal.Width)) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-boxplot-1.svg" width="672"  style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Species, <span class="dt">y =</span> Petal.Width)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-3" title="3"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-boxplot-2.svg" width="672"  style="display: block; margin: auto;" /></p>
</div>
<div id="density-plots-1" class="section level3">
<h3><span class="header-section-number">9.2.2</span> Density Plots</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Petal.Width)) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-3" title="3"><span class="st">  </span><span class="kw">geom_density</span>()</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-density-1.svg" width="480"  style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Petal.Width, <span class="dt">color =</span> Species)) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-3" title="3"><span class="st">  </span><span class="kw">geom_density</span>()</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-density-color-1.svg" width="672"  style="display: block; margin: auto;" /></p>
</div>
<div id="scatterplots-1" class="section level3">
<h3><span class="header-section-number">9.2.3</span> Scatterplots</h3>
<p>If we want to see the relationship between a flower’s petal length and its petal width, we can make a scatterplot.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Petal.Width, <span class="dt">y =</span> Petal.Length)) <span class="op">+</span></a>
<a class="sourceLine" id="cb23-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-scatterplot-marginal-1.svg" width="480"  style="display: block; margin: auto;" /></p>
<p>Perhaps this relationship varies by species. In that case we need to differentiate each point based on the <code>Species</code> variable. We have multiple options to do so. Two that make immediate sense would be to differentiate species by color or by shape.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb24-3" title="3">    <span class="kw">aes</span>(</a>
<a class="sourceLine" id="cb24-4" title="4">      <span class="dt">x =</span> Petal.Width,</a>
<a class="sourceLine" id="cb24-5" title="5">      <span class="dt">y =</span> Petal.Length,</a>
<a class="sourceLine" id="cb24-6" title="6">      <span class="dt">color =</span> Species</a>
<a class="sourceLine" id="cb24-7" title="7">    )) <span class="op">+</span></a>
<a class="sourceLine" id="cb24-8" title="8"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-scatterplot-grouped-1.svg" width="672"  style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb25-3" title="3">    <span class="kw">aes</span>(</a>
<a class="sourceLine" id="cb25-4" title="4">      <span class="dt">x =</span> Petal.Width,</a>
<a class="sourceLine" id="cb25-5" title="5">      <span class="dt">y =</span> Petal.Length,</a>
<a class="sourceLine" id="cb25-6" title="6">      <span class="dt">shape =</span> Species</a>
<a class="sourceLine" id="cb25-7" title="7">    )</a>
<a class="sourceLine" id="cb25-8" title="8">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-9" title="9"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-scatterplot-grouped-2.svg" width="672"  style="display: block; margin: auto;" /></p>
</div>
<div id="faceted-plots" class="section level3">
<h3><span class="header-section-number">9.2.4</span> Faceted Plots</h3>
<p>Another option would have been to create a separate scatterplot for each species. In the plot below, each section of the grid is called a <strong>facet</strong>. We’ll also save an initial (unfaceted) plot so we can play with the facet settings a bit.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">petal_facet &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Petal.Width, <span class="dt">y =</span> Petal.Length)) <span class="op">+</span></a>
<a class="sourceLine" id="cb26-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb26-4" title="4"></a>
<a class="sourceLine" id="cb26-5" title="5">petal_facet <span class="op">+</span></a>
<a class="sourceLine" id="cb26-6" title="6"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(Species))</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-scatter-facet-1.svg" width="672"  style="display: block; margin: auto;" /></p>
<p>If we wanted a single column, we could have asked <code>facet_wrap()</code> for one.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">petal_facet <span class="op">+</span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(Species), <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-scatter-facet-1col-1.svg" width="288"  style="display: block; margin: auto;" /></p>
<p>In practice, you will choose particular plot designs to illuminate the aspects of your data you want to highlight.</p>
</div>
<div id="bar-plots" class="section level3">
<h3><span class="header-section-number">9.2.5</span> Bar Plots</h3>
<p>To demonstrate the difference between two functions, <code>geom_bar()</code> and <code>geom_col()</code>, we’ll create a binary variable that encodes whether a given observation had a petal length less than 2 or at least 2.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb28-2" title="2"></a>
<a class="sourceLine" id="cb28-3" title="3"><span class="co">### make discrete categories for Petal.Length</span></a>
<a class="sourceLine" id="cb28-4" title="4"><span class="co">### only to demonstrate geom_bar and geom_col</span></a>
<a class="sourceLine" id="cb28-5" title="5">iris_new &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb28-6" title="6"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb28-7" title="7">    <span class="dt">PL.group =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb28-8" title="8">      Petal.Length <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> &quot;PL1&quot;</span>,</a>
<a class="sourceLine" id="cb28-9" title="9">      Petal.Length <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> &quot;PL2&quot;</span>,</a>
<a class="sourceLine" id="cb28-10" title="10">      <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span></a>
<a class="sourceLine" id="cb28-11" title="11">    )</a>
<a class="sourceLine" id="cb28-12" title="12">  )</a>
<a class="sourceLine" id="cb28-13" title="13"></a>
<a class="sourceLine" id="cb28-14" title="14"><span class="kw">head</span>(iris_new)</a></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species PL.group
## 1          5.1         3.5          1.4         0.2  setosa      PL1
## 2          4.9         3.0          1.4         0.2  setosa      PL1
## 3          4.7         3.2          1.3         0.2  setosa      PL1
## 4          4.6         3.1          1.5         0.2  setosa      PL1
## 5          5.0         3.6          1.4         0.2  setosa      PL1
## 6          5.4         3.9          1.7         0.4  setosa      PL1</code></pre>
<p>The <code>geom_bar()</code> function will count up the number of members in each group.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1">iris_new <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb30-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> PL.group)) <span class="op">+</span></a>
<a class="sourceLine" id="cb30-3" title="3"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-bar1-1.svg" width="480"  style="display: block; margin: auto;" /></p>
<p>Let’s make that a little prettier, shall we?</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">iris_new <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> PL.group)) <span class="op">+</span></a>
<a class="sourceLine" id="cb31-3" title="3"><span class="st">  </span><span class="kw">geom_bar</span>(</a>
<a class="sourceLine" id="cb31-4" title="4">    <span class="dt">fill =</span> <span class="st">&quot;lightgray&quot;</span>,</a>
<a class="sourceLine" id="cb31-5" title="5">    <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>,</a>
<a class="sourceLine" id="cb31-6" title="6">    <span class="dt">width =</span> <span class="fl">0.5</span></a>
<a class="sourceLine" id="cb31-7" title="7">  )</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-bar2-1.svg" width="480"  style="display: block; margin: auto;" /></p>
<p>Often you’ll find that you’ll be summarizing your data to make certain types of plots. Let’s say we had already counted the number of members per <code>PL.group</code> level ourselves, as so:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">iris_sum &lt;-<span class="st"> </span>iris_new <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(PL.group)</a>
<a class="sourceLine" id="cb32-2" title="2">iris_sum</a></code></pre></div>
<pre><code>##   PL.group   n
## 1      PL1  50
## 2      PL2 100</code></pre>
<p>To create the preceding plot, we would use <code>geom_col()</code> instead of <code>geom_bar()</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1">iris_sum <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb34-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> PL.group, <span class="dt">y =</span> n)) <span class="op">+</span></a>
<a class="sourceLine" id="cb34-3" title="3"><span class="st">  </span><span class="kw">geom_col</span>(</a>
<a class="sourceLine" id="cb34-4" title="4">    <span class="dt">fill =</span> <span class="st">&quot;lightgray&quot;</span>,</a>
<a class="sourceLine" id="cb34-5" title="5">    <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>,</a>
<a class="sourceLine" id="cb34-6" title="6">    <span class="dt">width =</span> <span class="fl">0.5</span></a>
<a class="sourceLine" id="cb34-7" title="7">  )</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-geom-col-1.svg" width="480"  style="display: block; margin: auto;" /></p>
<p>In most cases, you’ll find more than one viable route to your chosen graphic.</p>
</div>
<div id="scatterplot-matrix-1" class="section level3">
<h3><span class="header-section-number">9.2.6</span> Scatterplot Matrix</h3>
<p>Base R has a nice function to create scatterplot matrices. To do so with <code>ggplot2</code> we need to install another package called <code>GGally</code>.</p>
<p><span class="marginnote idea">
One wonderful think about <code>ggplot2</code> is that it boasts a universe of extensions written by R users to achieve specific plotting goals. While learning the ins and outs of <code>ggplot2</code> is fun (for me, anyway), you may find <a href="https://exts.ggplot2.tidyverse.org">extensions</a> useful.
</span></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1">GGally<span class="op">::</span><span class="kw">ggpairs</span>(iris)</a></code></pre></div>
<p><img src="stats-comp-ph_files/figure-html/ggplot-ggallymatrix-1.svg" width="672"  style="display: block; margin: auto;" /></p>
<p>This visualization is nice because it gives you a lot of information in a small space. The bottom row even contains embedded facets!</p>

</div>
</div>
</div>
<p style="text-align: center;">
<a href="functionalizing-code.html"><button class="btn btn-default">Previous</button></a>
<a href="programming-concepts.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
